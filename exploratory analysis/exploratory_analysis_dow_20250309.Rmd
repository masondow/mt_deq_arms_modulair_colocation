---
title: "Exploratory Data Analysis for FEM and Modulair PM2.5"
author: "Mason"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Required Libraries
```{r}
library(tidyverse)
library(lubridate)
library(readxl)
library(gt)
```

## Load Data
```{r}
# Define file paths
lt_data <- read_excel("../data/LT_data.xlsx")
nc_data <- read_excel("../data/NC_data.xlsx")
rp_data <- read_excel("../data/RP_data.xlsx")

# Standardizing column names to lowercase (will manually do this this in files later)
lt_data <- rename_with(lt_data, tolower)
nc_data <- rename_with(nc_data, tolower)
rp_data <- rename_with(rp_data, tolower)
```

## Convert DateTime and Check Structure
```{r}
lt_data <- lt_data %>% mutate(datetime = as_datetime(datetime))
nc_data <- nc_data %>% mutate(datetime = as_datetime(datetime))
rp_data <- rp_data %>% mutate(datetime = as_datetime(datetime))

# View data structures
glimpse(lt_data)
glimpse(nc_data)
glimpse(rp_data)
```

# Step 1: Descriptive Statistics

## 1.1 Summary Statistics for PM2.5 and Meteorological Data
```{r}
# LT Site
lt_summary <- lt_data %>%
  summarise(
    site = "LT",
    mean_pm25_fem = mean(lt_thermo, na.rm = TRUE),
    sd_pm25_fem = sd(lt_thermo, na.rm = TRUE),
    min_pm25_fem = min(lt_thermo, na.rm = TRUE),
    max_pm25_fem = max(lt_thermo, na.rm = TRUE),
    mean_pm25_mod = mean(lt_modulair_pm25, na.rm = TRUE),
    sd_pm25_mod = sd(lt_modulair_pm25, na.rm = TRUE),
    min_pm25_mod = min(lt_modulair_pm25, na.rm = TRUE),
    max_pm25_mod = max(lt_modulair_pm25, na.rm = TRUE),
    mean_rh = mean(lt_modulair_rh, na.rm = TRUE),
    mean_temp = mean(lt_modulair_tempc, na.rm = TRUE)
  )

# NC Site
nc_summary <- nc_data %>%
  summarise(
    site = "NC",
    mean_pm25_fem = mean(nc_1020, na.rm = TRUE),
    sd_pm25_fem = sd(nc_1020, na.rm = TRUE),
    min_pm25_fem = min(nc_1020, na.rm = TRUE),
    max_pm25_fem = max(nc_1020, na.rm = TRUE),
    mean_pm25_mod = mean(nc_modulair_pm25, na.rm = TRUE),
    sd_pm25_mod = sd(nc_modulair_pm25, na.rm = TRUE),
    min_pm25_mod = min(nc_modulair_pm25, na.rm = TRUE),
    max_pm25_mod = max(nc_modulair_pm25, na.rm = TRUE),
    mean_rh = mean(nc_modulair_rh, na.rm = TRUE),
    mean_temp = mean(nc_modulair_tempc, na.rm = TRUE)
  )

# RP Site (Comparing Multiple FEM Streams)
rp_summary <- rp_data %>%
  summarise(
    site = "RP",
    mean_pm25_fem_1020 = mean(rp_1020, na.rm = TRUE),
    sd_pm25_fem_1020 = sd(rp_1020, na.rm = TRUE),
    min_pm25_fem_1020 = min(rp_1020, na.rm = TRUE),
    max_pm25_fem_1020 = max(rp_1020, na.rm = TRUE),
    mean_pm25_fem_1022 = mean(rp_1022, na.rm = TRUE),
    sd_pm25_fem_1022 = sd(rp_1022, na.rm = TRUE),
    min_pm25_fem_1022 = min(rp_1022, na.rm = TRUE),
    max_pm25_fem_1022 = max(rp_1022, na.rm = TRUE),
    mean_pm25_fem_thermo = mean(rp_thermo, na.rm = TRUE),
    sd_pm25_fem_thermo = sd(rp_thermo, na.rm = TRUE),
    min_pm25_fem_thermo = min(rp_thermo, na.rm = TRUE),
    max_pm25_fem_thermo = max(rp_thermo, na.rm = TRUE),
    mean_pm25_fem_avg = mean(rp_fem_avg, na.rm = TRUE),
    mean_pm25_fem_weighted = mean(rp_fem_weighted_avg, na.rm = TRUE),
    mean_pm25_mod = mean(rp_modulair_pm25, na.rm = TRUE),
    sd_pm25_mod = sd(rp_modulair_pm25, na.rm = TRUE),
    min_pm25_mod = min(rp_modulair_pm25, na.rm = TRUE),
    max_pm25_mod = max(rp_modulair_pm25, na.rm = TRUE)
  )

summary_table <- bind_rows(lt_summary, nc_summary, rp_summary)
summary_table %>% gt()
```


## 1.2 Boxplots for PM2.5 Distribution by Site
```{r}



```



## 1.3 Correlation Analysis (Direct Comparisons by Site)
```{r}
# LT Site
cor_lt <- cor(lt_data$lt_thermo, lt_data$lt_modulair_pm25, use = "complete.obs")

# NC Site
cor_nc <- cor(nc_data$nc_1020, nc_data$nc_modulair_pm25, use = "complete.obs")

# RP Site (Comparing Different FEM Sources)
cor_rp <- tibble(
  FEM_Source = c("RP_1020", "RP_1022", "RP_FEM_Avg", "RP_FEM_Weighted_Avg"),
  Correlation = c(
    cor(rp_data$rp_1020, rp_data$rp_modulair_pm25, use = "complete.obs"),
    cor(rp_data$rp_1022, rp_data$rp_modulair_pm25, use = "complete.obs"),
    cor(rp_data$rp_fem_avg, rp_data$rp_modulair_pm25, use = "complete.obs"),
    cor(rp_data$rp_fem_weighted_avg, rp_data$rp_modulair_pm25, use = "complete.obs")
  )
)

list(LT_Correlation = cor_lt, NC_Correlation = cor_nc, RP_Correlation_Table = cor_rp)
```


